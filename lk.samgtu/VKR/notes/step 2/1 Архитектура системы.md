### **2. Проектирование программного комплекса**  

#### **2.1. Архитектура системы**  

##### **Выбор технологий**  
Для разработки программного комплекса были выбраны следующие технологии:  

- **Backend**:  
  - **Laravel (PHP)** – фреймворк с богатой экосистемой, поддерживающий REST API, очереди задач и удобную работу с БД.  
  - **MySQL** – реляционная СУБД для хранения структурированных данных (меню, заказы, пользователи).  
  - **Redis** – кэширование и управление сессиями для повышения производительности.  

- **Frontend**:  
  - **Flutter (Dart)** – кроссплатформенный фреймворк для мобильных приложений (iOS/Android) и веб-интерфейсов.  
  - **Vue.js** – для административной панели (управление ресторанами, курьерами, аналитика).  

- **Инфраструктура**:  
  - **Docker** – контейнеризация для упрощения развертывания.  
  - **Nginx** – веб-сервер и балансировщик нагрузки.  
  - **WebSocket** – для real-time уведомлений (статусы заказов).  

##### **Схема взаимодействия компонентов**  
Система строится по **модульной микросервисной архитектуре**:  

1. **Клиентское приложение (Flutter)**:  
   - Отправляет запросы к API (Laravel) для получения меню, оформления заказов.  
   - Получает push-уведомления через Firebase Cloud Messaging (FCM).  

2. **Backend (Laravel)**:  
   - **API Gateway**: Единая точка входа для всех запросов.  
   - **Сервис заказов**: Обрабатывает создание, изменение и статусы заказов.  
   - **Сервис ресторанов**: Управляет меню, стоп-листами, графиком работы.  
   - **Сервис оплаты**: Интегрируется с Tinkoff, СБП, PayPal.  
   - **Сервис логистики**: Оптимизирует маршруты курьеров (интеграция с Яндекс.Карты).  

3. **Админ-панель (Vue.js)**:  
   - Визуализация данных (графики продаж, активные заказы).  
   - Управление пользователями и настройками системы.  

4. **База данных (MySQL)**:  
   - Таблицы: `users`, `orders`, `restaurants`, `couriers`, `payments`.  
   - Репликация Master-Slave для отказоустойчивости.  

5. **Внешние интеграции**:  
   - **Платежные системы** (Tinkoff API).  
   - **Геосервисы** (Яндекс.Карты для маршрутизации).  
   - **SMS-рассылки** (Twilio для уведомлений клиентов).  

```mermaid
graph TD
  A[Клиент (Flutter)] -->|API запросы| B[Laravel Backend]
  B --> C[MySQL]
  B --> D[Redis]
  B --> E[Сервис оплаты]
  B --> F[Сервис логистики]
  G[Админ-панель (Vue.js)] --> B
  H[Курьер (Flutter)] --> B
  E -->|Tinkoff API| I[Банковские системы]
  F -->|Яндекс.Карты| J[Геоданные]
```

#### **2.2. Модульная структура**  
##### **Ключевые модули**:  
1. **Модуль заказов**:  
   - Создание, редактирование, отмена.  
   - Автоматическое распределение заказов курьерам.  

2. **Модуль ресторанов**:  
   - Личный кабинет с аналитикой продаж.  
   - Управление стоп-листами и акциями.  

3. **Модуль курьеров**:  
   - Трекинг местоположения (GPS).  
   - Расчет рейтинга на основе отзывов.  

4. **Модуль оплаты**:  
   - Поддержка многоразовых платежных ссылок.  
   - Возврат средств при отмене заказа.  

##### **Пример API-эндпоинтов**:  
- `POST /api/orders` – создание заказа.  
- `GET /api/restaurants/{id}/menu` – получение меню ресторана.  
- `PATCH /api/couriers/{id}/location` – обновление локации курьера.  

#### **2.3. Бизнес-процессы**  
1. **Оформление заказа**:  
   - Клиент выбирает блюда → система проверяет доступность → назначает курьера → отправляет уведомление ресторану.  

2. **Доставка**:  
   - Курьер получает заказ → система строит маршрут → клиент отслеживает доставку в реальном времени.  

3. **Обратная связь**:  
   - После доставки клиент оценивает сервис → рейтинг влияет на приоритет ресторана в поиске.  

#### **2.4. Доработки базового решения**  
- **Исправлено**:  
  - Оптимизация SQL-запросов для ускорения загрузки меню на 40%.  
  - Добавлена поддержка СБП для РФ.  
- **Добавлено**:  
  - Гибкие зоны доставки с учетом плотности заказов.  
  - Виджет чата между клиентом и курьером.  

---

### **Вывод**  
Спроектированная архитектура обеспечивает:  
- **Масштабируемость** за счет микросервисов.  
- **Отказоустойчивость** через репликацию БД.  
- **Гибкость** для подключения новых ресторанов.  

Далее в **Главе 3** будет описана реализация и тестирование системы.