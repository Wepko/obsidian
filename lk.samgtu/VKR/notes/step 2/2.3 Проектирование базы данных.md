# **2.3. Проектирование базы данных программного комплекса для сервисов доставки еды**  

## **2.3.1. Анализ предметной области и инфологическая модель**  

В результате анализа предметной области были выявлены основные сущности, лежащие в основе системы, и соответствующие им атрибуты. Они представлены в **Таблице 1**.  

### **Таблица 1 – Сущности предметной области**  

| **Сущность**          | **Описание**                                                                 |
|-----------------------|-----------------------------------------------------------------------------|
| **Users**             | Пользователи системы (клиенты, курьеры, сотрудники магазинов, администраторы) |
| **Roles**             | Роли пользователей для разграничения прав                                   |
| **Shops**             | Магазины/рестораны, предоставляющие услуги доставки                        |
| **Zones**             | Географические зоны доставки                                               |
| **Couriers**          | Информация о курьерах, включая тип транспорта и зону работы               |
| **Categories**        | Категории товаров (еда, напитки и т. д.)                                   |
| **Products**          | Товары/блюда, доступные для заказа                                         |
| **Product_attributes**| Дополнительные атрибуты товаров (размер, состав и т. д.)                   |
| **Product_addons**    | Дополнения к товарам (соусы, гарниры)                                      |
| **Orders**            | Заказы пользователей                                                       |
| **Order_items**       | Состав заказа (товары и их количество)                                     |
| **Order_item_attributes** | Выбранные атрибуты для товаров в заказе                                |
| **Order_item_addons** | Выбранные дополнения для товаров в заказе                                  |
| **Transactions**      | Финансовые операции (оплаты, возвраты)                                     |
| **Modules**           | Бизнес-модули системы (разные типы сервисов доставки)                      |
| **Business_settings** | Настройки бизнес-логики                                                    |
| **Translations**      | Многоязычные переводы интерфейса                                           |

Далее была разработана **даталогическая модель базы данных**, представленная на **Рисунке 4**.  

## **2.3.2. Реализация таблиц базы данных**  

В соответствии с проектом были реализованы следующие таблицы.  

### **Таблица 2 – Таблица Users**  

| **Атрибут**          | **Тип данных**       | **Длина/значение**                          | **Описание**                              |
|----------------------|----------------------|--------------------------------------------|------------------------------------------|
| `id`                 | `BIGINT` (PK)        | AUTO_INCREMENT                             | Уникальный идентификатор                 |
| `name`               | `VARCHAR`            | 255                                        | Имя пользователя                         |
| `email`              | `VARCHAR`            | 255 (UNIQUE)                               | Электронная почта                        |
| `email_verified_at`  | `TIMESTAMP`          | NULLABLE                                   | Дата подтверждения email                 |
| `password`           | `VARCHAR`            | 255                                        | Хеш пароля                               |
| `phone`              | `VARCHAR`            | 20                                         | Номер телефона                           |
| `avatar`             | `VARCHAR`            | 255 (NULLABLE)                             | Путь к аватару                           |
| `type`               | `ENUM`               | `client`, `courier`, `shop_staff`, `admin` | Тип пользователя                         |
| `status`             | `ENUM`               | `active`, `inactive`, `banned`             | Статус аккаунта                          |
| `current_zone_id`    | `BIGINT` (FK)        | NULLABLE                                   | Текущая зона доставки                    |
| `created_at`         | `TIMESTAMP`          | CURRENT_TIMESTAMP                          | Дата создания                            |
| `updated_at`         | `TIMESTAMP`          | CURRENT_TIMESTAMP ON UPDATE                | Дата обновления                          |
| `deleted_at`         | `TIMESTAMP`          | NULLABLE                                   | Мягкое удаление                          |

### **Таблица 3 – Таблица Shops**  

| **Атрибут**          | **Тип данных**       | **Длина/значение**                          | **Описание**                              |
|----------------------|----------------------|--------------------------------------------|------------------------------------------|
| `id`                 | `BIGINT` (PK)        | AUTO_INCREMENT                             | Уникальный ID магазина                   |
| `owner_id`           | `BIGINT` (FK)        |                                            | Владелец (связь с `users.id`)            |
| `name`               | `VARCHAR`            | 255                                        | Название магазина                        |
| `description`        | `TEXT`               | NULLABLE                                   | Описание                                 |
| `address`            | `VARCHAR`            | 255                                        | Физический адрес                         |
| `latitude`           | `DECIMAL`            | 10,8                                       | Координата (широта)                      |
| `longitude`          | `DECIMAL`            | 11,8                                       | Координата (долгота)                     |
| `phone`              | `VARCHAR`            | 20                                         | Контактный телефон                       |
| `email`              | `VARCHAR`            | 255                                        | Контактный email                         |
| `logo`               | `VARCHAR`            | 255 (NULLABLE)                             | Путь к логотипу                          |
| `status`             | `ENUM`               | `active`, `inactive`, `closed`             | Статус магазина                          |
| `delivery_fee`       | `DECIMAL`            | 8,2                                        | Стоимость доставки                       |
| `min_order`          | `DECIMAL`            | 8,2                                        | Минимальная сумма заказа                 |
| `created_at`         | `TIMESTAMP`          | CURRENT_TIMESTAMP                          | Дата создания                            |

*(Аналогично оформляются остальные таблицы: **Couriers, Orders, Products и т. д.**)*  

### **Таблица 4 – Таблица Orders**  

| **Атрибут**          | **Тип данных**       | **Длина/значение**                          | **Описание**                              |
|----------------------|----------------------|--------------------------------------------|------------------------------------------|
| `id`                 | `BIGINT` (PK)        | AUTO_INCREMENT                             | Уникальный ID заказа                     |
| `user_id`            | `BIGINT` (FK)        |                                            | Клиент (`users.id`)                      |
| `shop_id`            | `BIGINT` (FK)        |                                            | Магазин (`shops.id`)                     |
| `order_number`       | `VARCHAR`            | 50 (UNIQUE)                                | Номер заказа                             |
| `order_type`         | `ENUM`               | `delivery`, `pickup`                       | Тип заказа                               |
| `payment_status`     | `ENUM`               | `pending`, `paid`, `failed`                | Статус оплаты                            |
| `order_status`       | `ENUM`               | `pending`, `processing`, `delivered` и др. | Статус заказа                            |
| `total`              | `DECIMAL`            | 10,2                                       | Итоговая сумма                           |
| `created_at`         | `TIMESTAMP`          | CURRENT_TIMESTAMP                          | Дата создания                            |

*(Продолжение для остальных таблиц в аналогичном формате.)*  

## **2.3.3. Вывод**  

В данном разделе была разработана **инфологическая модель базы данных**, включающая **17 таблиц**, которые охватывают все аспекты работы сервиса доставки еды:  
- Управление пользователями (`users`, `roles`).  
- Работу магазинов (`shops`, `products`).  
- Логистику (`couriers`, `zones`, `orders`).  
- Финансы (`transactions`).  
- Настройки системы (`business_settings`, `modules`).  

Спроектированная база данных обеспечивает **гибкость, масштабируемость и высокую производительность**, что соответствует требованиям современного сервиса доставки.

---
### **Описание структуры таблиц базы данных**

#### **1. Таблица Users (Пользователи)**
В системе представлена таблица пользователей, которая является ключевой для идентификации всех участников платформы. В данной таблице содержатся следующие основные элементы:
- Уникальный идентификатор пользователя (id) с автоинкрементом
- Персональные данные (name, email, phone)
- Система аутентификации (password, email_verified_at)
- Медиа-контент (avatar)
- Ролевая модель (type) с вариантами: клиент, курьер, персонал магазина, администратор
- Механизм управления доступом (status)
- Географическая привязка (current_zone_id)
- Временные метки и механизм мягкого удаления

Особенностью данной таблицы является реализация комплексной системы управления пользователями с поддержкой различных ролей и статусов, что обеспечивает гибкость управления правами доступа.

#### **2. Таблица Shops (Магазины)**
В системе реализована таблица магазинов, содержащая полную информацию о торговых точках. Основные компоненты таблицы включают:
- Уникальный идентификатор магазина (id)
- Связь с владельцем (owner_id)
- Базовые данные магазина (name, description)
- Физическое расположение (address, latitude, longitude)
- Контактные данные (phone, email)
- Логотип (logo)
- Бизнес-параметры (delivery_fee, min_order)
- Статус работы магазина

Главной особенностью данной структуры является детализированное описание географического положения и бизнес-параметров каждого магазина, что критически важно для работы системы доставки.

#### **3. Таблица Orders (Заказы)**
Система включает таблицу заказов, которая является центральной для обработки транзакций. Структура таблицы содержит:
- Уникальный идентификатор заказа (id)
- Связи с пользователем и магазином (user_id, shop_id)
- Уникальный номер заказа (order_number)
- Тип заказа (order_type)
- Статусы оплаты и выполнения
- Финансовые показатели (total)
- Временные метки создания

Ключевой особенностью данной таблицы является реализация сложной логики статусов заказов и их связи с другими сущностями системы, что обеспечивает полный контроль над процессом выполнения заказов.

**Примечание:** Все таблицы используют единый подход к проектированию с:
- BIGINT для первичных ключей
- Временными метками для аудита
- Механизмом мягкого удаления
- Строгой типизацией данных
- ENUM-типами для ограниченных наборов значений

Такая структура обеспечивает целостность данных и масштабируемость системы.