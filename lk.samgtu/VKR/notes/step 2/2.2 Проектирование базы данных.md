# **2.3. Проектирование базы данных программного комплекса для сервисов доставки еды**  

## **2.3.1. Анализ предметной области и инфологическая модель**  

В результате анализа предметной области были выявлены основные сущности, лежащие в основе системы, и соответствующие им атрибуты. Они представлены в **Таблице 1**.  

### **Таблица 1 – Сущности предметной области**  

| **Сущность**          | **Описание**                                                                 |
|-----------------------|-----------------------------------------------------------------------------|
| **Users**             | Пользователи системы (клиенты, курьеры, сотрудники магазинов, администраторы) |
| **Roles**             | Роли пользователей для разграничения прав                                   |
| **Shops**             | Магазины/рестораны, предоставляющие услуги доставки                        |
| **Zones**             | Географические зоны доставки                                               |
| **Couriers**          | Информация о курьерах, включая тип транспорта и зону работы               |
| **Categories**        | Категории товаров (еда, напитки и т. д.)                                   |
| **Products**          | Товары/блюда, доступные для заказа                                         |
| **Product_attributes**| Дополнительные атрибуты товаров (размер, состав и т. д.)                   |
| **Product_addons**    | Дополнения к товарам (соусы, гарниры)                                      |
| **Orders**            | Заказы пользователей                                                       |
| **Order_items**       | Состав заказа (товары и их количество)                                     |
| **Order_item_attributes** | Выбранные атрибуты для товаров в заказе                                |
| **Order_item_addons** | Выбранные дополнения для товаров в заказе                                  |
| **Transactions**      | Финансовые операции (оплаты, возвраты)                                     |
| **Modules**           | Бизнес-модули системы (разные типы сервисов доставки)                      |
| **Business_settings** | Настройки бизнес-логики                                                    |
| **Translations**      | Многоязычные переводы интерфейса                                           |

Далее была разработана **даталогическая модель базы данных**, представленная на **Рисунке 4**.  

## **2.3.2. Реализация таблиц базы данных**  

В соответствии с проектом были реализованы следующие таблицы.  

### **Таблица 2 – Таблица Users**  

| **Атрибут**          | **Тип данных**       | **Длина/значение**                          | **Описание**                              |
|----------------------|----------------------|--------------------------------------------|------------------------------------------|
| `id`                 | `BIGINT` (PK)        | AUTO_INCREMENT                             | Уникальный идентификатор                 |
| `name`               | `VARCHAR`            | 255                                        | Имя пользователя                         |
| `email`              | `VARCHAR`            | 255 (UNIQUE)                               | Электронная почта                        |
| `email_verified_at`  | `TIMESTAMP`          | NULLABLE                                   | Дата подтверждения email                 |
| `password`           | `VARCHAR`            | 255                                        | Хеш пароля                               |
| `phone`              | `VARCHAR`            | 20                                         | Номер телефона                           |
| `avatar`             | `VARCHAR`            | 255 (NULLABLE)                             | Путь к аватару                           |
| `type`               | `ENUM`               | `client`, `courier`, `shop_staff`, `admin` | Тип пользователя                         |
| `status`             | `ENUM`               | `active`, `inactive`, `banned`             | Статус аккаунта                          |
| `current_zone_id`    | `BIGINT` (FK)        | NULLABLE                                   | Текущая зона доставки                    |
| `created_at`         | `TIMESTAMP`          | CURRENT_TIMESTAMP                          | Дата создания                            |
| `updated_at`         | `TIMESTAMP`          | CURRENT_TIMESTAMP ON UPDATE                | Дата обновления                          |
| `deleted_at`         | `TIMESTAMP`          | NULLABLE                                   | Мягкое удаление                          |

### **Таблица 3 – Таблица Shops**  

| **Атрибут**          | **Тип данных**       | **Длина/значение**                          | **Описание**                              |
|----------------------|----------------------|--------------------------------------------|------------------------------------------|
| `id`                 | `BIGINT` (PK)        | AUTO_INCREMENT                             | Уникальный ID магазина                   |
| `owner_id`           | `BIGINT` (FK)        |                                            | Владелец (связь с `users.id`)            |
| `name`               | `VARCHAR`            | 255                                        | Название магазина                        |
| `description`        | `TEXT`               | NULLABLE                                   | Описание                                 |
| `address`            | `VARCHAR`            | 255                                        | Физический адрес                         |
| `latitude`           | `DECIMAL`            | 10,8                                       | Координата (широта)                      |
| `longitude`          | `DECIMAL`            | 11,8                                       | Координата (долгота)                     |
| `phone`              | `VARCHAR`            | 20                                         | Контактный телефон                       |
| `email`              | `VARCHAR`            | 255                                        | Контактный email                         |
| `logo`               | `VARCHAR`            | 255 (NULLABLE)                             | Путь к логотипу                          |
| `status`             | `ENUM`               | `active`, `inactive`, `closed`             | Статус магазина                          |
| `delivery_fee`       | `DECIMAL`            | 8,2                                        | Стоимость доставки                       |
| `min_order`          | `DECIMAL`            | 8,2                                        | Минимальная сумма заказа                 |
| `created_at`         | `TIMESTAMP`          | CURRENT_TIMESTAMP                          | Дата создания                            |

*(Аналогично оформляются остальные таблицы: **Couriers, Orders, Products и т. д.**)*  

### **Таблица 4 – Таблица Orders**  

| **Атрибут**          | **Тип данных**       | **Длина/значение**                          | **Описание**                              |
|----------------------|----------------------|--------------------------------------------|------------------------------------------|
| `id`                 | `BIGINT` (PK)        | AUTO_INCREMENT                             | Уникальный ID заказа                     |
| `user_id`            | `BIGINT` (FK)        |                                            | Клиент (`users.id`)                      |
| `shop_id`            | `BIGINT` (FK)        |                                            | Магазин (`shops.id`)                     |
| `order_number`       | `VARCHAR`            | 50 (UNIQUE)                                | Номер заказа                             |
| `order_type`         | `ENUM`               | `delivery`, `pickup`                       | Тип заказа                               |
| `payment_status`     | `ENUM`               | `pending`, `paid`, `failed`                | Статус оплаты                            |
| `order_status`       | `ENUM`               | `pending`, `processing`, `delivered` и др. | Статус заказа                            |
| `total`              | `DECIMAL`            | 10,2                                       | Итоговая сумма                           |
| `created_at`         | `TIMESTAMP`          | CURRENT_TIMESTAMP                          | Дата создания                            |

*(Продолжение для остальных таблиц в аналогичном формате.)*  

## **2.3.3. Вывод**  

В данном разделе была разработана **инфологическая модель базы данных**, включающая **17 таблиц**, которые охватывают все аспекты работы сервиса доставки еды:  
- Управление пользователями (`users`, `roles`).  
- Работу магазинов (`shops`, `products`).  
- Логистику (`couriers`, `zones`, `orders`).  
- Финансы (`transactions`).  
- Настройки системы (`business_settings`, `modules`).  

Спроектированная база данных обеспечивает **гибкость, масштабируемость и высокую производительность**, что соответствует требованиям современного сервиса доставки.