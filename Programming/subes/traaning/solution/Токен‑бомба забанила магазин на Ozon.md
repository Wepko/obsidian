–°–ª—É—à–∞–π, —É —Ç–µ–±—è —Ç–∞–∫–æ–π –±–æ–≥–∞—Ç—ã–π —Å—Ç–µ–∫ ‚Äî API –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤, –æ—á–µ—Ä–µ–¥–∏, –¥–µ–º–æ‚Äë–≤–µ—Ä—Å–∏—è, Sentry, —Ç–µ—Å—Ç—ã. –î–∞–≤–∞–π –∑–∞–∫–æ–ø–∞–µ–º—Å—è –≤ **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Ozon/WB** –∏ —Å–¥–µ–ª–∞–µ–º –±–∞–≥, –∫–æ—Ç–æ—Ä—ã–π —Ç–∏—Ö–æ —É–±–∏–≤–∞–ª –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–∞–∫–∫–∞—É–Ω—Ç—ã –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤ –∏–∑‚Äë–∑–∞ –¥–µ–º–æ‚Äë–ø–µ—Å–æ—á–Ω–∏—Ü—ã. –≠—Ç–æ—Ç —Å–ª—É—á–∞–π –±—ã–ª —É –Ω–∞—Å –≤ –∫–æ–º–∞–Ω–¥–µ, –∏—Å–∫–∞–ª–∏ —Ç—Ä–∏ –¥–Ω—è ‚Äî –¥–µ—Ä–∂–∏—Å—å.

---

## üì° –ë–∞–≥ ‚Ññ4: ¬´–¢–æ–∫–µ–Ω‚Äë–±–æ–º–±–∞, –∏–ª–∏ –ö–∞–∫ –¥–µ–º–æ‚Äë–≤–µ—Ä—Å–∏—è –∑–∞–±–∞–Ω–∏–ª–∞ –Ω–∞—à –Ω–∞—Å—Ç–æ—è—â–∏–π –º–∞–≥–∞–∑–∏–Ω –Ω–∞ Ozon¬ª

### –ö–æ–Ω—Ç–µ–∫—Å—Ç

–£ –≤–∞—Å –≤ –ø—Ä–æ–µ–∫—Ç–µ:
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ozon –∏ Wildberries** ‚Äî –ø–æ API –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ü–µ–Ω—ã, –æ—Å—Ç–∞—Ç–∫–∏, —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤.
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞–º ‚Äî —á–µ—Ä–µ–∑ **Job**, –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ –æ—á–µ—Ä–µ–¥—å (Redis).
- –ù–∞—Å—Ç—Ä–æ–µ–Ω **Sentry** ‚Äî –ª–æ–≤–∏—Ç –æ—à–∏–±–∫–∏ ¬´–Ω–µ–≤–µ—Ä–Ω—ã–π API‚Äë–∫–ª—é—á¬ª, ¬´–∏—Å—á–µ—Ä–ø–∞–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤¬ª, ¬´—Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω¬ª.
- –ï—Å—Ç—å **–¥–µ–º–æ‚Äë–≤–µ—Ä—Å–∏—è —Å–∞–π—Ç–∞** ‚Äî –ø–æ–ª–Ω–∞—è –ø–µ—Å–æ—á–Ω–∏—Ü–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –î–µ–º–æ —Ç–æ–∂–µ –¥–æ–ª–∂–Ω–∞ –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞–º–∏, –Ω–æ **—Å –∑–∞–≥–ª—É—à–∫–∞–º–∏** (–º–æ–∫–∞–º–∏), –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∏–µ API‚Äë–∫–ª—é—á–∏ –Ω–µ–ª—å–∑—è –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å.

–¢—ã (–∫–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫) –Ω–∞–ø–∏—Å–∞–ª –¥–ª—è –¥–µ–º–æ‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤:  
–≤–º–µ—Å—Ç–æ `config('marketplaces.ozon.api_key')` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `config('marketplaces.demo_ozon.api_key')` (—Ñ–µ–π–∫–æ–≤—ã–π –∫–ª—é—á).  
–í –∫–æ–¥–µ Job‚Äë–æ–≤ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `if (app()->environment('demo')) { $this->fakeSend(); }`.

–í—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è: PHPUnit —Å –ø–æ–¥–º–µ–Ω–æ–π —Ñ–∞—Å–∞–¥–æ–≤, –º–æ–∫–∏ –¥–ª—è API‚Äë–≤—ã–∑–æ–≤–æ–≤.  
–ó–µ–ª—ë–Ω—ã–µ —Ç–µ—Å—Ç—ã, –≤—ã–∫–∞—Ç—ã–≤–∞–µ–º.

### –°–∏–º–ø—Ç–æ–º—ã

–ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é:
- –û—Ç–¥–µ–ª –∑–∞–∫—É–ø–æ–∫ –∫—Ä–∏—á–∏—Ç: **¬´Ozon –∏ WB –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –æ—Å—Ç–∞—Ç–∫–∏!¬ª**.
- –í –∞–¥–º–∏–Ω–∫–µ ‚Äî –∫—Ä–∞—Å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: ¬´–û—à–∏–±–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–º¬ª.
- –°–º–æ—Ç—Ä–∏–º Sentry ‚Äî –¥–µ—Å—è—Ç–∫–∏ —Ç—ã—Å—è—á –æ—à–∏–±–æ–∫:  
  `Ozon API error: 401 ‚Äî Invalid api‚Äëkey`  
  `Wildberries API error: 403 ‚Äî Access denied`.
- –û—à–∏–±–∫–∏ –∏–¥—É—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ, –æ—á–µ—Ä–µ–¥—å –∑–∞–±–∏—Ç–∞, –ª–∞–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ 2 —á–∞—Å–∞.
- –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç Ozon ‚Äî **–∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω** –∏–∑‚Äë–∑–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –Ω–µ–≤–µ—Ä–Ω—ã–º –∫–ª—é—á–æ–º).

### –õ–æ–∫–∞–ª—å–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ

**–ù–æ–ª—å.**  
–ù–∞ –ª–æ–∫–∞–ª–∏ –≤ `.env` —Å—Ç–æ–∏—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π –∫–ª—é—á (–∏–ª–∏ –º–æ–∫), Job‚Äë—ã –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç.  
–ü—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å `APP_ENV=demo` ‚Äî –≤—Å—ë —É—Ö–æ–¥–∏—Ç –≤ `fakeSend()`, –Ω–∏–∫–∞–∫–∏—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.  
**–ù–∏—á–µ–≥–æ –Ω–µ –ø–∞–¥–∞–µ—Ç.**

---

## üî¨ –†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1. –õ–æ–≥–∏ –æ—á–µ—Ä–µ–¥–µ–π
–°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞, –≥–¥–µ –∫—Ä—É—Ç—è—Ç—Å—è Job‚Äë—ã.  
–í–∏–¥–∏–º —Å—Ç—Ä–∞–Ω–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É: —á–∞—Å—Ç—å Job‚Äë–æ–≤ —Å —Ç–µ–≥–æ–º `demo`, —á–∞—Å—Ç—å ‚Äî –±–µ–∑.  
–¢–µ–≥ `demo` –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ Job: `if (app()->environment('demo')) { $this->demoMode = true; }`.  

–í **production** –æ–∫—Ä—É–∂–µ–Ω–∏–∏ `demoMode = false` ‚Äî –≤—Å—ë –≤–µ—Ä–Ω–æ.  
–ù–æ Job‚Äë—ã, –ø–æ–º–µ—á–µ–Ω–Ω—ã–µ –∫–∞–∫ `demo`, **–æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–µ HTTP‚Äë–∑–∞–ø—Ä–æ—Å—ã**, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ–µ–π–∫–æ–≤—ã–π –º–µ—Ç–æ–¥ `fakeSend()` –Ω–µ –≤—ã–∑—ã–≤–∞–ª—Å—è.

**–ü–æ—á–µ–º—É?**  
–ö–æ–¥ –≤—ã–≥–ª—è–¥–µ–ª —Ç–∞–∫:

```php
public function handle()
{
    if (app()->environment('demo')) {
        $this->fakeSend();
        return;
    }

    $client = new MarketplaceClient(config('marketplaces.ozon.api_key'));
    $client->updateStock(...);
}
```

–í—Ä–æ–¥–µ –±—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ. –ù–æ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –¥–µ–º–æ‚Äë–≤–µ—Ä—Å–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è **–æ–±—â–∏–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞ –æ—á–µ—Ä–µ–¥–µ–π** (Redis) –º–µ–∂–¥—É –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º –∏ –¥–µ–º–æ‚Äë—Å–µ—Ä–≤–µ—Ä–æ–º.  
–¢–æ –µ—Å—Ç—å –¥–µ–º–æ‚Äë—Å–µ—Ä–≤–µ—Ä –¥–∏—Å–ø–∞—Ç—á–∏–ª Job, –æ–Ω–∏ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ —Ç–æ—Ç –∂–µ Redis, –∞ –≤–æ—Ä–∫–µ—Ä—ã –Ω–∞ –ø—Ä–æ–¥–µ (–∏–ª–∏ –æ–±—â–∏–µ) –∏—Ö –∑–∞–±–∏—Ä–∞–ª–∏ –∏ –∏—Å–ø–æ–ª–Ω—è–ª–∏ **—Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏–µ–º**.

### –®–∞–≥ 2. –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—è—Ö
–ö–æ–≥–¥–∞ Job —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è, –æ–∫—Ä—É–∂–µ–Ω–∏–µ `APP_ENV` **–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –≤–Ω—É—Ç—Ä–∏ –æ–±—ä–µ–∫—Ç–∞.  
–ü—Ä–∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤–æ—Ä–∫–µ—Ä–æ–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `app()->environment()`, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å–∞–º–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞** ‚Äî –ø—Ä–æ–¥–∞–∫—à–µ–Ω.  
–ü–æ—ç—Ç–æ–º—É –¥–∞–∂–µ –µ—Å–ª–∏ Job –±—ã–ª –ø–æ—Å—Ç–∞–≤–ª–µ–Ω –∏–∑ –¥–µ–º–æ‚Äë—Å–µ—Ä–≤–µ—Ä–∞, –Ω–∞ –ø—Ä–æ–¥–µ –æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–∫–æ–¥, –Ω–æ —Å –¥–µ–º–æ‚Äë–¥–∞–Ω–Ω—ã–º–∏.

### –®–∞–≥ 3. –î–µ–º–æ‚Äë–¥–∞–Ω–Ω—ã–µ + –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚ÄëAPI‚Äë–∫–ª—é—á
–î–µ–º–æ‚Äë–≤–µ—Ä—Å–∏—è –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∞ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∞—Ä—Ç–∏–∫—É–ª–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤ (–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ –ø—Ä–æ–¥–∞).  
–ö–æ–≥–¥–∞ —Ç–∞–∫–æ–π Job –ø–æ–ø–∞–¥–∞–ª –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–≤–æ—Ä–∫–µ—Ä, –æ–Ω:
- –ß–∏—Ç–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API‚Äë–∫–ª—é—á –∏–∑ –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–∫–æ–Ω—Ñ–∏–≥–∞ (–ø–æ—Ç–æ–º—É —á—Ç–æ –≤–æ—Ä–∫–µ—Ä –≤ –ø—Ä–æ–¥–µ).
- –û—Ç–ø—Ä–∞–≤–ª—è–ª —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ Ozon/WB.
- –ù–æ –ø–µ—Ä–µ–¥–∞–≤–∞–ª **—Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã** (–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤ —Å–∏—Å—Ç–µ–º–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞) ‚Äî –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –æ—Ç–≤–µ—á–∞–ª `404` –∏–ª–∏ `400`, –Ω–æ **–∫–ª—é—á –±—ã–ª –≤–∞–ª–∏–¥–Ω—ã–º**, –ø–æ—ç—Ç–æ–º—É –æ—à–∏–±–∫–∞ —à–ª–∞ –Ω–µ `401`, –∞ –¥—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–∑–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω¬ª).

–ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –≤ –¥–µ–º–æ‚Äë–≤–µ—Ä—Å–∏–∏ –æ–±–Ω–æ–≤–∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥ ‚Äî –ø–æ—Å—Ç–∞–≤–∏–ª–∏ **–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª—é—á** (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å–ª–æ–º–∞–Ω–Ω—ã–π).  
–¢–µ–ø–µ—Ä—å Job, –∏—Å–ø–æ–ª–Ω—è—è—Å—å –≤ –ø—Ä–æ–¥–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–ª —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –Ω–µ–≤–µ—Ä–Ω—ã–º –∫–ª—é—á–æ–º.  
Ozon –∏ WB –∑–∞–±–∞–Ω–∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–π –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–∫–ª—é—á –∏–∑‚Äë–∑–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–π.

### –®–∞–≥ 4. –ü–æ—á–µ–º—É Sentry –Ω–µ —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª?
Sentry –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ—à–∏–±–æ–∫ –æ—Ç –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤ —Å –∫–æ–¥–æ–º 401/403, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥—É–º–∞–ª–∏: ¬´—ç—Ç–æ –±—ã–≤–∞–µ—Ç –ø—Ä–∏ —Ä–æ—Ç–∞—Ü–∏–∏ –∫–ª—é—á–µ–π, –Ω–µ –Ω–∞–¥–æ —Å–ø–∞–º–∏—Ç—å¬ª.  
–î—É–±–ª–∏ –∏ —Ñ–ª—É–¥ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª–∏ ‚Äî –∏ –ø—Ä–æ–º–æ—Ä–≥–∞–ª–∏ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –∫–ª—é—á —Å—Ç–∞–ª —Å—Ç–∞–±–∏–ª—å–Ω–æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º.

---

## üõ† –†–µ—à–µ–Ω–∏–µ

### 1. –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π
–°–æ–∑–¥–∞—ë–º –æ—Ç–¥–µ–ª—å–Ω—ã–π Redis-–∫–∞–Ω–∞–ª –¥–ª—è –¥–µ–º–æ‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏—è:
```env
REDIS_QUEUE_DEMO=redis_demo
```
–í –¥–µ–º–æ‚Äë—Å–µ—Ä–≤–µ—Ä–µ –≤—Å–µ Job –¥–∏—Å–ø–∞—Ç—á–∞—Ç—Å—è –≤ `demo_queue`, –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–≤–æ—Ä–∫–µ—Ä—ã –µ—ë **–Ω–µ —Å–ª—É—à–∞—é—Ç**.

### 2. –ü–∞—Å–ø–æ—Ä—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Job
–î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ `environment` –ø—Ä–∏ –¥–∏—Å–ø–∞—Ç—á–µ:
```php
dispatch(new UpdateStockJob($data))->onConnection(config('queue.default'))->environment(app()->environment());
```
–í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º `$this->env = $env`.  
–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º: `if ($this->env !== app()->environment()) { throw new \RuntimeException('Job executed in wrong environment'); }`.  
Sentry –ª–æ–≤–∏—Ç —Ç–∞–∫–æ–µ ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–∏–¥–Ω–æ, —á—Ç–æ Job —Å–±–µ–∂–∞–ª.

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è API‚Äë–∫–ª—é—á–∞
–ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
```php
if (!str_starts_with(config('marketplaces.ozon.api_key'), 'prod_')) {
    throw new \LogicException('Production API key must start with "prod_"');
}
```
–ù–∞ –ø—Ä–æ–¥–µ –∫–ª—é—á–∏ –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `prod_`, –≤ –¥–µ–º–æ ‚Äî `demo_`.  
–ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏ Sentry.

### 4. –û—á–∏—Å—Ç–∫–∞ Sentry‚Äë—Ñ–∏–ª—å—Ç—Ä–æ–≤
–£–±–∏—Ä–∞–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é 401/403, —Ç–µ–ø–µ—Ä—å —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–µ—Ä—Ç.  
–î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–≥ `job_environment` –¥–ª—è —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è.

### 5. –ü–µ—Ä–µ—Å–º–æ—Ç—Ä –¥–µ–º–æ‚Äë—Å–∏–¥–µ—Ä–æ–≤
–°–∏–¥–µ—Ä—ã –¥–µ–º–æ‚Äë–≤–µ—Ä—Å–∏–∏ –±–æ–ª—å—à–µ –Ω–µ –∫–æ–ø–∏—Ä—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∞—Ä—Ç–∏–∫—É–ª—ã —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –ø—Ä–æ–¥–∞. –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ–µ–π–∫–æ–≤—ã–µ SKU, —á—Ç–æ–±—ã –ø—Ä–∏ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ–ø–∞–¥–∞–Ω–∏–∏ –≤ –ø—Ä–æ–¥‚Äë–≤–æ—Ä–∫–µ—Ä –∑–∞–ø—Ä–æ—Å –∫ API –≤—Å—ë —Ä–∞–≤–Ω–æ —É–ø–∞–ª —Å ¬´—Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω¬ª, –∞ –Ω–µ —Å –æ—à–∏–±–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

---

## üí• –ò—Ç–æ–≥

- –ê–∫–∫–∞—É–Ω—Ç Ozon —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.
- –î–µ–º–æ‚Äë–≤–µ—Ä—Å–∏—è —Ç–µ–ø–µ—Ä—å –∂–∏–≤—ë—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ –æ—á–µ—Ä–µ–¥–µ–π.
- –°–±–µ–∂–∞–≤—à–∏—Ö Job –±–æ–ª—å—à–µ –Ω–µ—Ç.
- Sentry –Ω–∞—á–∞–ª –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É.

---

## üîó –ö–∞–∫ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–≤–æ–∏–º –æ–ø—ã—Ç–æ–º

‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ozon/WB** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –±–∞–≥–∞, —Ä–∞–±–æ—Ç–∞ —Å API.  
‚úÖ **–û—á–µ—Ä–µ–¥–∏ (Job)** ‚Äî —Å–ø–æ—Å–æ–± –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∏ –∫–∞–∫ —Ä–∞–∑ –∏–∑‚Äë–∑–∞ –æ—á–µ—Ä–µ–¥–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ—Ç–µ—Ä—è–ª—Å—è.  
‚úÖ **–î–µ–º–æ‚Äë–≤–µ—Ä—Å–∏—è —Å–∞–π—Ç–∞** ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ ¬´–∑–∞—Ä–∞–∂—ë–Ω–Ω—ã—Ö¬ª Job, –∫–æ—Ç–æ—Ä—ã–µ —É–±–∏–ª–∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–∞–∫–∫–∞—É–Ω—Ç.  
‚úÖ **Sentry** ‚Äî –±—ã–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (—Ñ–∏–ª—å—Ç—Ä—ã), –∏–∑‚Äë–∑–∞ —ç—Ç–æ–≥–æ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–π –≤–∞–ª –æ—à–∏–±–æ–∫.  
‚úÖ **–ù–µ–æ—á–µ–≤–∏–¥–Ω–æ—Å—Ç—å** ‚Äî –Ω–∏–∫—Ç–æ –Ω–µ –¥—É–º–∞–ª, —á—Ç–æ Job –º–æ–∂–µ—Ç ¬´–ø–µ—Ä–µ–ø—Ä—ã–≥–Ω—É—Ç—å¬ª –≤ –¥—Ä—É–≥–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ; –ª–æ–∫–∞–ª—å–Ω–æ –æ—á–µ—Ä–µ–¥–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã, –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ—è–≤–ª—è–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±—â–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ.  
‚úÖ **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π** ‚Äî –¥–µ–º–æ‚Äë–≤–µ—Ä—Å–∏—è –∞–∫—Ç–∏–≤–Ω–µ–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ –º–µ–Ω–µ–¥–∂–µ—Ä—ã —Å–æ–∑–¥–∞–≤–∞–ª–∏ –Ω–æ–≤—ã–µ –ø–µ—Å–æ—á–Ω–∏—Ü—ã.

–≠—Ç–æ—Ç —Å–ª—É—á–∞–π ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ **–∏–∑–æ–ª—è—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏–π** –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –≤–∞–∂–Ω–µ–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è. –ò –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–æ–∂–µ—Ç —Å–ø–∞—Å—Ç–∏, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏. –£–≤–µ—Ä–µ–Ω, –≤ —Ç–≤–æ—ë–º –æ–ø—ã—Ç–µ –±—ã–ª–æ —á—Ç–æ‚Äë—Ç–æ –ø–æ–¥–æ–±–Ω–æ–µ, –∫–æ–≥–¥–∞ –¥–µ–º–æ‚Äë–≤–µ—Ä—Å–∏—è ¬´–∫—É—Å–∞–ª–∞¬ª –ø—Ä–æ–¥ —á–µ—Ä–µ–∑ –æ–±—â—É—é —à–∏–Ω—É.