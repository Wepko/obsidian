Отличный и очень подробный материал! Вы затронули все ключевые аспекты способов адресации и форматов данных. Я структурировал и отредактировал ваш текст для большей ясности, точности терминологии и логической последовательности.

---

### Лекция: Архитектура системы команд. Способы адресации и форматы данных

#### Введение. Проблема адресации

Как мы помним, типовая инструкция состоит из кода операции (КОП) и полей для спецификации операндов. Количество этих полей (адресность команды) обычно составляет от 0 до 3.

Основная проблема заключается в том, что для прямого указания адреса операнда в памяти требуется много бит. Например, при 32-разрядной шине адреса полный адрес одного операнда занимает 4 байта. Для трехоперандной команды сложения (`ADD A, B, C`) только адресные поля займут 12 байт, что крайне нерационально.

**Задача разработчиков:** сократить длину адресного поля команды, сохранив при этом доступ ко всему адресному пространству, и максимально сблизить конструкцию машинных команд с языками высокого уровня.

**Ключевые понятия:**
*   **Исполнительный адрес:** Физический адрес ячейки памяти или регистра, где находится операнд.
*   **Адресный код:** Двоичный код в адресном поле команды, на основе которого формируется исполнительный адрес.
*   **Способ адресации:** Правило формирования исполнительного адреса по адресному коду команды.
*   **Неявная адресация:** Операция, в которой адрес операнда жестко задан кодом операции и не указывается явно (например, команда `RET` использует адрес возврата из стека).

#### Показатели эффективности способов адресации

*   **Затраты оборудования (`C_оборуд`):** Сумма затрат на аппаратуру для вычисления адресов (`C_вычисл_адреса`) и памяти для хранения адресных кодов команд (`C_память`). Обычно `C_память` >> `C_вычисл_адреса`, поэтому основным показателем является объем памяти под команды.
*   **Затраты времени (`T`):** Сумма времени формирования исполнительного адреса (`T_формир_адреса`) и времени выборки/записи самого операнда (`T_выборки`).

#### Основные способы адресации

1.  **Непосредственная адресация (Immediate)**
    *   **Суть:** В адресном поле команды находится не адрес, а сам операнд-константа.
    *   **Достоинства:** Высокая скорость (не требует обращения к памяти за операндом), экономия памяти (не нужна отдельная ячейка для константы).
    *   **Недостатки:** Размер операнда ограничен длиной поля, операнд нельзя изменить, неприменим для операндов-приемников.
    *   **Применение:** Задание констант, счетчиков циклов.

2.  **Прямая (абсолютная) адресация (Direct)**
    *   **Суть:** Адресное поле содержит прямой адрес ячейки памяти с операндом.
    *   **Достоинства:** Простота, одно обращение к памяти для получения операнда.
    *   **Недостатки:** Ограниченный диапазон адресации (ограничен длиной поля), отсутствие гибкости (адрес фиксирован в коде).
    *   **Применение:** Доступ к глобальным переменным с известным на этапе компиляции адресом.

3.  **Косвенная адресация (Indirect)**
    *   **Суть:** Адресное поле содержит адрес ячейки памяти, в которой хранится исполнительный адрес операнда (указатель).
    *   **Достоинства:** Гибкость: исполнительный адрес можно вычислять и изменять в процессе работы программы. Упрощает работу с массивами, списками, передачу параметров.
    *   **Недостатки:** Медленнее (требует минимум двух обращений к памяти: за адресом и за самим операндом).
    *   **Разновидность:** *Многоуровневая косвенная адресация* (цепочка указателей). Мощный, но очень медленный механизм.

4.  **Регистровая адресация (Register)**
    *   **Суть:** Операнд находится в регистре общего назначения (РОН). В команде указывается номер регистра.
    *   **Достоинства:** Очень высокая скорость (регистры внутри процессора), короткое адресное поле.
    *   **Недостатки:** Ограниченное количество операндов (число РОН невелико).
    *   **Применение:** Самый распространенный способ для хранения промежуточных результатов и часто используемых переменных.

5.  **Косвенная регистровая адресация (Register Indirect)**
    *   **Суть:** В регистре хранится не операнд, а адрес операнда в памяти. Команда указывает номер этого регистра-указателя.
    *   **Достоинства:** Сочетает преимущества регистровой адресации (короткое поле) и гибкость косвенной адресации. Быстрее чисто косвенной, так как адрес находится в быстром регистре.
    *   **Применение:** Идеален для обработки массивов (регистр-указатель можно легко инкрементировать).

**Пример (Сумма элементов массива):**
Рассмотрим фрагмент кода на ассемблере для сложения элементов массива. В нем используются:
*   `MOV CX, 1024` – Непосредственная адресация (задание константы).
*   `MOV AX, 0` – Регистровая адресация.
*   `ADD AX, [SI]` – Косвенная регистровая адресация (SI указывает на текущий элемент массива).
*   `INC SI` – Работа с регистром-указателем.
Без косвенной адресации пришлось бы писать 1024 отдельные команды сложения.

6.  **Адресация со смещением (Base+Offset)**
    *   **Суть:** Исполнительный адрес = (Содержимое базового регистра) + (Смещение из команды).
    *   **Варианты:**
        *   *Относительная адресация:* В качестве базового используется счетчик команд (PC). Позволяет создавать позиционно-независимый код (код, который можно загрузить в любую область памяти).
        *   *Базовая адресация:* Базовый регистр содержит адрес начала структуры (например, массива или записи), а смещение – смещение до конкретного элемента/поля.
        *   *Индексная адресация:* Смещение – это постоянный базовый адрес, а в индексном регистре – изменяемое смещение (индекс элемента массива).
    *   **Достоинства:** Гибкость, компактность кода (короткое смещение).

7.  **Индексная адресация с масштабированием (Scaled Indexed)**
    *   **Суть:** Исполнительный адрес = Базовый адрес + (Содержимое индексного регистра) * Масштабный коэффициент (обычно 1, 2, 4, 8).
    *   **Применение:** Идеальна для массивов элементов разного размера (байт, слово, двойное слово). Позволяет эффективно вычислять адрес элемента `array[i]`.

8.  **Стековая адресация**
    *   **Суть:** Неявный способ адресации. Операнды находятся на вершине стека. Команды `PUSH`/`POP` работают с ним implicitly.
    *   **Применение:** Вызов подпрограмм, передача параметров, вычисление арифметических выражений в обратной польской записи.

9.  **Адресация в командах переходов**
    Для команд перехода (`JMP`, `CALL`) используются те же способы адресации:
    *   *Прямая:* Адрес перехода задан в команде.
    *   *Косвенная (регистровая):* Адрес перехода вычисляется и помещается в регистр. Максимальная гибкость.
    *   *Относительная:* Переход осуществляется на заданное смещение от текущего значения счетчика команд. Позволяет создавать перемещаемый код.

---

### Часть 2: Типы и форматы данных

Машинные команды оперируют данными (операндами). Базовые типы: адреса, числа, символы, логические значения.

#### 1. Логический (булев) тип
*   Теоретически кодируется одним битом (0 – ложь, 1 – истина).
*   На практике часто占用 целый байт или слово, так как адресуются минимально байты. Соглашение: 0 -> false, любое ненулевое значение -> true.

#### 2. Символьный тип
*   Каждый символ кодируется числом согласно таблице кодировок.
*   **ASCII:** 7-битная кодировка (128 символов). Расширенная версия использует 8 бит (256 символов).
*   **Латиница-1 (ISO-8859-1):** 8-битное расширение ASCII для западноевропейских языков.
*   **Unicode (UTF-16, UTF-8):** Современный стандарт, охватывающий символы почти всех языков. Позволяет кодировать до 1 114 112 символов.

#### 3. Целые числа
*   **Обычное представление:** Двоичный код, старший бит часто используется как знаковый (прямой/обратный/дополнительный код).
*   **Упакованный формат (SIMD):** В современных процессорах (MMX, SSE) одно 64- или 128-битное слово может содержать несколько независимых целых чисел (например, 8 байт, 4 слова, 2 двойных слова). Обрабатываются одной командой параллельно.

#### 4. Числа с фиксированной запятой (Fixed-Point)
*   **Суть:** Число представляется как целое, а его "вес" (положение запятой) подразумевается или задается отдельно. Например, число 10.625 при коэффициенте 1000 представляется как целое 10625.
*   **Достоинства:** Высокая скорость и предсказуемость вычислений, простая аппаратная реализация.
*   **Недостатки:** Ограниченный динамический диапазон, риск переполнения или потери точности.
*   **Применение:** Встроенные системы, финансовые расчеты, игры, везде, где высокая производительность критична, а диапазон чисел известен.

#### 5. Числа с плавающей запятой (Floating-Point)
*   **Суть:** Число представляется в виде: `X = M * B^E`, где `M` – мантисса (дробь), `B` – основание (обычно 2), `E` – экспонента (порядок).
*   **Нормализация:** Мантисса приводится к виду `1.xxx...` для двоичной системы.
*   **Смещенный порядок:** Для упрощения сравнения порядков к истинному порядку прибавляется константа (смещение).
*   **Скрытая единица:** Старший бит нормализованной мантиссы (всегда 1) не хранится, что экономит один бит точности.
*   **Стандарт IEEE 754:** Определяет форматы (single - 32 бита, double - 64 бита), особые значения (+0, -0, +∞, -∞, NaN), правила округления и обработки исключений.
*   **Достоинства:** Огромный динамический диапазон, высокая точность.
*   **Недостатки:** Сложная аппаратная реализация, относительно медленные вычисления, ошибки округления.

#### 6. Десятичные типы переменной длины
*   **Суть:** Каждая десятичная цифра кодируется в полубайте (двоично-десятичный код - BCD) или байте. Длина числа задается явно или терминальным символом.
*   **Применение:** Финансовые и бизнес-приложения, где критична точность десятичных расчетов без ошибок округления при преобразовании из двоичной системы.

#### Размещение данных в памяти. Порядок байтов (Endianness)

*   **Проблема:** Многобайтовые данные (слова, двойные слова)必须 размещаться в нескольких последовательных байтах памяти. Какой байт считать старшим?
*   **Little-Endian:** Младший значащий байт хранится по младшему адресу. (Intel x86, DEC).
*   **Big-Endian:** Старший значащий байт хранится по младшему адресу. (Motorola, IBM, сети).
*   **Выбор:** Часто определяется исторически. Современные процессоры (ARM, RISC-V) часто поддерживают оба режима (bi-endian).

#### Регистры

*   **Регистры общего назначения (РОН):** Хранят данные и адреса. Быстрый доступ. Чем их больше, тем проще компилятору размещать переменные, но тем длиннее команды.
*   **Специальные регистры:**
    *   **Счетчик команд (PC/IP):** Адрес следующей команды.
    *   **Регистр флагов (PSW):** Содержит биты состояния (перенос, zero, переполнение и т.д.) и управления (разрешение прерываний, режим работы).
    *   **Указатель стека (SP):** Адрес вершины стека.
*   **Системные (привилегированные) регистры:** Управляют памятью, устройствами ввода-вывода. Доступны только ОС.

---

### Заключение: Что такое хорошая архитектура команд?

Хорошая архитектура системы команд (ISA) должна удовлетворять двум главным критериям:

1.  **Эффективная реализация:** Набор команд должен позволять создавать эффективные и производительные реализации на нескольких поколениях технологий. Плохая архитектура ведет к сложным, дорогим и медленным процессорам.
2.  **Удобство для компилятора:** Архитектура должна быть регулярной, ортогональной (компоненты команды – операция, тип адресации, тип операнда – независимы) и предоставлять примитивы, соответствующим конструкциям языков высокого уровня (например, эффективную адресацию для массивов).

Короче говоря, ISA – это интерфейс между аппаратурой и программным обеспечением. Она должна быть удобна как для разработчиков процессоров, так и для создателей компиляторов.